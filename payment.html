<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Beyond Time - ãŠæ”¯æ‰•ã„</title>
<script src="https://js.stripe.com/v3/"></script>
<style>
@import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Noto+Sans+JP:wght@400;700;900&display=swap');
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
body{font-family:'Noto Sans JP','Orbitron',sans-serif;background:#000;min-height:100vh;display:flex;align-items:center;justify-content:center;color:#fff;padding:20px;overflow-x:hidden;touch-action:manipulation}
body::before{content:'';position:fixed;top:0;left:0;width:100%;height:100%;background:radial-gradient(circle at 50% 50%,#1a1a2e 0%,#000 100%);animation:pulse 8s ease-in-out infinite;z-index:-2}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.75}}
.stars{position:fixed;width:100%;height:100%;z-index:-1;pointer-events:none}
.star{position:absolute;width:2px;height:2px;background:#fff;border-radius:50%;animation:twinkle 3s ease-in-out infinite}
@keyframes twinkle{0%,100%{opacity:0}50%{opacity:1}}
.container{max-width:600px;width:100%;background:rgba(0,0,0,.95);padding:40px;border-radius:20px;border:3px solid rgba(122,92,255,.5);box-shadow:0 0 60px rgba(122,92,255,.4);position:relative;z-index:1}
.title{font-size:clamp(1.5rem,5vw,2rem);background:linear-gradient(135deg,#00d4ff 0%,#7a5cff 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;margin-bottom:30px;font-weight:900;text-align:center;letter-spacing:.2em}
.plan-info{background:rgba(122,92,255,.1);padding:25px;border-radius:12px;margin-bottom:30px;border:2px solid rgba(122,92,255,.3)}
.plan-name{font-size:clamp(1.1rem,3vw,1.4rem);color:#00d4ff;margin-bottom:10px;font-weight:700}
.plan-price{font-size:clamp(1.5rem,4vw,2rem);color:#7a5cff;margin-bottom:15px;font-weight:900}
.plan-desc{font-size:clamp(.85rem,2.5vw,1rem);color:rgba(255,255,255,.8);line-height:1.8}
.payment-form{margin:30px 0}
.form-group{margin-bottom:20px}
.form-label{font-size:.9rem;color:#00d4ff;margin-bottom:8px;display:block;font-weight:700}
.form-input{width:100%;padding:15px;font-size:1rem;border:2px solid rgba(122,92,255,.5);border-radius:10px;background:rgba(0,0,0,.5);color:#fff;font-family:'Noto Sans JP',sans-serif;transition:all .3s}
.form-input:focus{outline:none;border-color:#7a5cff;box-shadow:0 0 25px rgba(122,92,255,.6)}
.form-input::placeholder{color:rgba(255,255,255,.4)}
#card-element{padding:15px;border:2px solid rgba(122,92,255,.5);border-radius:10px;background:rgba(0,0,0,.5);min-height:44px}
.btn-pay{background:linear-gradient(135deg,#00d4ff 0%,#7a5cff 100%);color:#000;border:none;padding:20px;border-radius:12px;cursor:pointer;font-size:clamp(1.1rem,3vw,1.3rem);width:100%;font-weight:900;box-shadow:0 0 40px rgba(122,92,255,.8);font-family:'Noto Sans JP',sans-serif;letter-spacing:.15em;transition:all .3s;margin-top:20px;position:relative;z-index:10;touch-action:manipulation}
.btn-pay:hover:not(:disabled){box-shadow:0 0 60px rgba(122,92,255,1);transform:translateY(-2px)}
.btn-pay:active:not(:disabled){transform:translateY(0) scale(.98)}
.btn-pay:disabled{opacity:.5;cursor:not-allowed;transform:none}
.error{color:#ff4444;font-size:.9rem;margin-top:10px;padding:10px;background:rgba(255,68,68,.1);border-radius:8px;border-left:3px solid #ff4444;display:none}
.error.active{display:block;animation:shake .5s}
@keyframes shake{0%,100%{transform:translateX(0)}25%{transform:translateX(-5px)}75%{transform:translateX(5px)}}
.loading{text-align:center;color:#7a5cff;margin:20px 0;display:none;font-size:1.1rem;font-weight:700}
.loading.active{display:block}
.loading::after{content:'';animation:dots 1.5s steps(4,end) infinite}
@keyframes dots{0%,20%{content:''}40%{content:'.'}60%{content:'..'}80%,100%{content:'...'}}
.secure-badge{text-align:center;margin-top:20px;font-size:.85rem;color:rgba(255,255,255,.6);display:flex;align-items:center;justify-content:center;gap:8px}
.secure-badge::before{content:"ğŸ”’";color:#00d4ff;font-size:1.2rem}
.success-message{background:rgba(0,255,0,.1);border:2px solid rgba(0,255,0,.5);padding:30px;border-radius:12px;text-align:center;display:none;animation:fadeInScale .5s ease-out}
.success-message.active{display:block}
@keyframes fadeInScale{from{opacity:0;transform:scale(.9)}to{opacity:1;transform:scale(1)}}
.success-title{font-size:clamp(1.5rem,4vw,2rem);color:#00ff00;margin-bottom:20px;font-weight:900}
.success-text{font-size:clamp(.95rem,2.5vw,1.1rem);color:rgba(255,255,255,.9);line-height:1.8}
.back-link{display:block;margin-top:20px;color:rgba(255,255,255,.6);text-align:center;font-size:.9rem;text-decoration:none;transition:color .3s;padding:10px}
.back-link:hover{color:#00d4ff}
.invalid-plan{color:#ff4444;text-align:center;padding:20px;font-size:1.1rem;line-height:1.6}
.test-cards{background:rgba(255,215,0,.1);border:2px solid rgba(255,215,0,.3);border-radius:10px;padding:15px;margin-top:20px;font-size:.85rem;color:rgba(255,255,255,.7)}
.test-cards-title{color:#ffd700;font-weight:900;margin-bottom:10px;font-size:.9rem}
.test-card-number{font-family:'Courier New',monospace;color:#00d4ff;font-weight:700;margin:5px 0}
@media(max-width:768px){.container{padding:30px 20px}.title{margin-bottom:20px}.plan-info{padding:20px}.form-group{margin-bottom:15px}.btn-pay{padding:18px}}
</style>
</head>
<body>
<div class="stars" id="stars"></div>
<div class="container">
<div class="title">ğŸ’³ ãŠæ”¯æ‰•ã„</div>

<div class="plan-info" id="planInfo">
<div class="plan-name" id="planName">èª­ã¿è¾¼ã¿ä¸­...</div>
<div class="plan-price" id="planPrice">Â¥---</div>
<div class="plan-desc" id="planDesc">ãƒ—ãƒ©ãƒ³æƒ…å ±ã‚’å–å¾—ã—ã¦ã„ã¾ã™...</div>
</div>

<div class="success-message" id="successMessage">
<div class="success-title">âœ… æ±ºæ¸ˆæˆåŠŸï¼</div>
<div class="success-text" id="successText"></div>
</div>

<form id="payment-form" class="payment-form">
<div class="form-group">
<label class="form-label">ãŠåå‰ *</label>
<input type="text" class="form-input" id="name" placeholder="å±±ç”° å¤ªéƒ" required autocomplete="name">
</div>

<div class="form-group">
<label class="form-label">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ *</label>
<input type="email" class="form-input" id="email" placeholder="example@email.com" required autocomplete="email">
</div>

<div class="form-group">
<label class="form-label">ã‚«ãƒ¼ãƒ‰æƒ…å ± *</label>
<div id="card-element"></div>
<div class="error" id="card-errors"></div>
</div>

<div class="test-cards">
<div class="test-cards-title">ğŸ§ª ãƒ†ã‚¹ãƒˆç”¨ã‚«ãƒ¼ãƒ‰ç•ªå·</div>
<div class="test-card-number">4242 4242 4242 4242</div>
<div style="font-size:.8rem;color:rgba(255,255,255,.5);margin-top:5px">æœ‰åŠ¹æœŸé™: ä»»æ„ã®æœªæ¥æ—¥ / CVC: ä»»æ„ã®3æ¡</div>
</div>

<button type="submit" class="btn-pay" id="submit-button">
âš¡ æ”¯æ‰•ã†
</button>

<div class="loading" id="loading">
æ±ºæ¸ˆå‡¦ç†ä¸­ã§ã™
</div>
</form>

<div class="secure-badge">
å®‰å…¨ãªæ±ºæ¸ˆï¼ˆStripeä½¿ç”¨ï¼‰
</div>

<a href="index.html" class="back-link">â† ã‚¨ãƒ³ãƒˆãƒ©ãƒ³ã‚¹ã«æˆ»ã‚‹</a>
</div>

<script>
const STRIPE_PUBLISHABLE_KEY='pk_test_51SRULXE90hNxeF7bObkIHe2xyOrQ6NZEFhKwxj9UWFyAyCX65gpKDiXD1iMM3VgPDAWqfOuAJgphapS2Ss9vjwDu00iSwc7QTr';
const plans={
birthday:{name:'èª•ç”Ÿæ—¥è¨ºæ–­',price:'Â¥100',amount:100,desc:'ç”Ÿå¹´æœˆæ—¥ã‹ã‚‰é‹å‘½ãƒ»æ‰èƒ½ãƒ»ç›¸æ€§ã‚’è¨ºæ–­',redirectUrl:'birthday-result.html'},
premium:{name:'Beyond Time - Premiumè¨ºæ–­',price:'Â¥980',amount:980,desc:'æ·±å±¤è¨ºæ–­ãƒ»è©³ç´°ãªå­˜åœ¨ã‚³ãƒ¼ãƒ‰ç”Ÿæˆ',redirectUrl:'beyond-time.html'},
restoration:{name:'Beyond Time - Time Restoration',price:'Â¥29,800',amount:29800,desc:'æ™‚é–“è»¸ã®å†æ§‹ç¯‰ãƒ»æ°¸é ã®ä»Šãƒœã‚¿ãƒ³ãƒ»ç©¶æ¥µã®å­˜åœ¨ã‚³ãƒ¼ãƒ‰',redirectUrl:'restoration.html'}
};
const urlParams=new URLSearchParams(window.location.search);
const planType=urlParams.get('plan')||'premium';
const currentPlan=plans[planType];
if(currentPlan){document.getElementById('planName').textContent=currentPlan.name;document.getElementById('planPrice').textContent=currentPlan.price;document.getElementById('planDesc').textContent=currentPlan.desc}else{document.getElementById('planInfo').innerHTML='<p class="invalid-plan">âš ï¸ ç„¡åŠ¹ãªãƒ—ãƒ©ãƒ³ã§ã™ã€‚<br><br>ã‚¨ãƒ³ãƒˆãƒ©ãƒ³ã‚¹ã‹ã‚‰ã‚„ã‚Šç›´ã—ã¦ãã ã•ã„ã€‚</p>';document.getElementById('payment-form').style.display='none'}
function createStars(){const starsContainer=document.getElementById('stars');const fragment=document.createDocumentFragment();for(let i=0;i<150;i++){const star=document.createElement('div');star.className='star';star.style.left=Math.random()*100+'%';star.style.top=Math.random()*100+'%';star.style.animationDelay=Math.random()*3+'s';fragment.appendChild(star)}starsContainer.appendChild(fragment)}
let stripe,elements,cardElement;
try{stripe=Stripe(STRIPE_PUBLISHABLE_KEY);elements=stripe.elements();cardElement=elements.create('card',{style:{base:{color:'#fff',fontFamily:'"Noto Sans JP", "Orbitron", sans-serif',fontSize:'16px',lineHeight:'24px','::placeholder':{color:'rgba(255, 255, 255, 0.4)'}},invalid:{color:'#ff4444',iconColor:'#ff4444'}},hidePostalCode:true});cardElement.mount('#card-element');cardElement.on('change',(event)=>{const errorElement=document.getElementById('card-errors');if(event.error){errorElement.textContent='âš ï¸ '+event.error.message;errorElement.classList.add('active')}else{errorElement.textContent='';errorElement.classList.remove('active')}});cardElement.on('ready',()=>{console.log('âœ… Stripe Card Element mounted successfully')})}catch(error){console.error('âŒ Stripe initialization error:',error);showError('æ±ºæ¸ˆã‚·ã‚¹ãƒ†ãƒ ã®åˆæœŸåŒ–ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿ã—ã¦ãã ã•ã„ã€‚')}
const form=document.getElementById('payment-form');
form.addEventListener('submit',async(event)=>{event.preventDefault();if(!currentPlan){showError('ç„¡åŠ¹ãªãƒ—ãƒ©ãƒ³ãŒé¸æŠã•ã‚Œã¦ã„ã¾ã™');return}if(!stripe||!cardElement){showError('æ±ºæ¸ˆã‚·ã‚¹ãƒ†ãƒ ãŒåˆæœŸåŒ–ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿ã—ã¦ãã ã•ã„ã€‚');return}const submitButton=document.getElementById('submit-button');const loading=document.getElementById('loading');const errorElement=document.getElementById('card-errors');submitButton.disabled=true;submitButton.textContent='å‡¦ç†ä¸­...';loading.classList.add('active');errorElement.classList.remove('active');try{const name=document.getElementById('name').value.trim();const email=document.getElementById('email').value.trim();if(!name||!email){throw new Error('ãŠåå‰ã¨ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„')}if(name.length<2){throw new Error('ãŠåå‰ã¯2æ–‡å­—ä»¥ä¸Šã§å…¥åŠ›ã—ã¦ãã ã•ã„')}if(!isValidEmail(email)){throw new Error('æœ‰åŠ¹ãªãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„')}const{paymentMethod,error}=await stripe.createPaymentMethod({type:'card',card:cardElement,billing_details:{name:name,email:email}});if(error){throw new Error(error.message)}console.log('âœ… PaymentMethod created:',paymentMethod.id);console.log('ğŸ’° Plan:',currentPlan.name);console.log('ğŸ’´ Amount:',currentPlan.amount);showSuccess(name,email)}catch(error){console.error('âŒ Payment error:',error);showError(error.message||'æ±ºæ¸ˆå‡¦ç†ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„ã€‚');submitButton.disabled=false;submitButton.textContent='âš¡ æ”¯æ‰•ã†'}finally{loading.classList.remove('active')}});
function isValidEmail(email){const emailRegex=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;return emailRegex.test(email)}
function showSuccess(name,email){document.getElementById('payment-form').style.display='none';document.getElementById('planInfo').style.display='none';const successMessage=document.getElementById('successMessage');successMessage.classList.add('active');document.getElementById('successText').innerHTML=`<strong>${escapeHtml(name)}</strong> æ§˜<br><br>æ±ºæ¸ˆãŒå®Œäº†ã—ã¾ã—ãŸï¼<br><br><strong>${escapeHtml(currentPlan.name)}</strong><br>${escapeHtml(currentPlan.price)}<br><br>ã”ç™»éŒ²ã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹<br><span style="color:#00d4ff">${escapeHtml(email)}</span><br>ã«ç¢ºèªãƒ¡ãƒ¼ãƒ«ã‚’é€ä¿¡ã—ã¾ã—ãŸã€‚<br><br><strong style="color:#ffd700">3ç§’å¾Œã«è¨ºæ–­ãƒšãƒ¼ã‚¸ã¸è‡ªå‹•ã§ç§»å‹•ã—ã¾ã™...</strong>`;setTimeout(()=>{let redirectUrl=currentPlan.redirectUrl+'?paid=true&email='+encodeURIComponent(email)+'&name='+encodeURIComponent(name)+'&plan='+encodeURIComponent(planType);if(planType==='birthday'){const year=urlParams.get('year');const month=urlParams.get('month');const day=urlParams.get('day');if(year&&month&&day){redirectUrl+=`&year=${year}&month=${month}&day=${day}`}}console.log('ğŸš€ Redirecting to:',redirectUrl);window.location.href=redirectUrl},3000)}
function showError(message){const errorElement=document.getElementById('card-errors');errorElement.textContent='âš ï¸ '+message;errorElement.classList.add('active');setTimeout(()=>{errorElement.classList.remove('active')},5000)}
function escapeHtml(text){const map={'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;'};return text.replace(/[&<>"']/g,m=>map[m])}
document.addEventListener('DOMContentLoaded',()=>{createStars();if(currentPlan){setTimeout(()=>{document.getElementById('name').focus()},100)}console.log('ğŸ”¥ Payment page initialized');console.log('ğŸ“¦ Plan:',planType)});
window.addEventListener('error',(event)=>{console.error('âŒ Global error:',event.error)});
window.addEventListener('unhandledrejection',(event)=>{console.error('âŒ Unhandled promise rejection:',event.reason)});
</script>
</body>
</html>