<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>KenGoSystem ‚Äî Fantasy Birthdate Analyzer</title>
<style>
:root{
  --bg:#0e0f14; --card:#131829; --ink:#eef6ff; --sub:#a9c3e6;
  --acc:#8be9fd; --ok:#a6ffcb; --rose:#ffb3c7; --vio:#cbb6ff; --sun:#ffe08a;
}
*{box-sizing:border-box} html,body{height:100%}
body{margin:0;background:radial-gradient(1200px 800px at 70% -10%,#1b2240 0%,#0e0f14 60%);color:var(--ink);
  font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial}
.wrap{padding:20px}
.card{
  background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
  border:1px solid rgba(255,255,255,.08); border-radius:20px; padding:22px;
  max-width:760px; margin:24px auto; box-shadow:0 20px 50px rgba(0,0,0,.45);
  backdrop-filter: blur(6px);
}
h1{font-size:22px;margin:2px 0 14px}
p.m{color:var(--sub);margin:6px 2px 0}
.grid{display:grid; grid-template-columns:1fr; gap:14px; margin:10px 0 8px}
@media (min-width:560px){ .grid{grid-template-columns:1fr 1fr} }
label{display:block;margin:6px 8px}
input[type="text"], input[type="date"]{
  width:100%; padding:12px 14px; border-radius:14px; border:1px solid #23304d;
  background:#0c1224; color:#fff; font-size:16px; outline:none;
}
input::placeholder{color:#6f87a8}
button{
  width:100%; margin-top:10px; padding:14px 16px; border:0; border-radius:14px;
  background:linear-gradient(90deg,var(--acc),var(--vio)); color:#001018; font-weight:800; font-size:18px; cursor:pointer;
}
button:active{transform:translateY(1px)}
.badges{display:flex; flex-wrap:wrap; gap:10px; margin:14px 0 6px}
.badge{
  background:#101834; border:1px solid rgba(255,255,255,.08); padding:8px 12px; border-radius:999px;
  display:inline-flex; align-items:center; gap:8px; font-size:14px
}
.emo{font-size:18px}
.result{
  margin-top:18px; padding:16px; border-radius:16px;
  background:linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.03));
  border:1px solid rgba(255,255,255,.08);
}
h2{font-size:18px; margin:6px 0 10px}
h3{font-size:16px; margin:14px 0 6px}
.kawaii{line-height:1.65}
.kawaii b{color:var(--ok)}
.kv{display:flex; gap:10px; align-items:center; margin:4px 0 10px}
.kv .big{font-size:26px}
.tag{background:#1a213e; border:1px solid rgba(255,255,255,.08); padding:6px 10px; border-radius:10px; font-size:13px}
.sharebtn{color:var(--acc); text-decoration:underline}
small.mini{color:var(--sub)}
.sep{height:1px;background:rgba(255,255,255,.08); margin:12px 0}
.footer{color:var(--sub); font-size:12px; margin-top:8px}
@supports (padding: max(0px)) {.wrap{padding-bottom:max(18px, env(safe-area-inset-bottom))}}
input,button,a{-webkit-tap-highlight-color:transparent}
input[type="date"]{appearance:none;-webkit-appearance:none}
</style>
<script>
// --- Language decide (query > device) ---
(function(){
  const qs=new URLSearchParams(location.search);
  const auto=(navigator.language||"").toLowerCase().startsWith("ja")?"ja":"en";
  window.APP_LANG=qs.get("lang")||auto;
  document.documentElement.setAttribute("lang",window.APP_LANG);
})();
</script>
</head>
<body>
  <main class="wrap">
    <section class="card">
      <h1 id="title"></h1>
      <p id="subtitle" class="m"></p>

      <div class="grid">
        <div>
          <label id="label_name" for="name"></label>
          <input id="name" type="text" inputmode="latin-name" placeholder="KenGo" autocomplete="nickname">
        </div>
        <div>
          <label id="label_birth" for="dob"></label>
          <input id="dob" type="date" inputmode="numeric" autocomplete="bday" placeholder="YYYY-MM-DD">
        </div>
      </div>

      <div class="badges">
        <span class="badge"><span class="emo">üß≠</span><span id="tip1"></span></span>
        <span class="badge"><span class="emo">üå¨Ô∏è</span><span id="tip2"></span></span>
        <span class="badge"><span class="emo">üîí</span><span id="tip3"></span></span>
      </div>

      <button id="run"></button>

      <div id="out" class="result" style="display:none">
        <div class="kv"><span class="big" id="emoji_core">‚ú®</span><div><h2 id="result_title"></h2><div class="tag" id="summary_tag"></div></div></div>
        <p class="kawaii" id="line_core"></p>
        <p class="kawaii" id="line_flow"></p>
        <p class="kawaii" id="line_form"></p>

        <div class="sep"></div>

        <h3 id="share_title"></h3>
        <p>
          <a id="share" href="#" class="sharebtn"></a><br>
          <small id="shareurl" class="mini"></small>
        </p>
        <p class="footer" id="disclaimer"></p>
      </div>
    </section>
  </main>

<script>
// ===== iOS date fallback (text mask) =====
(function iosDateFallback(){
  const ua=navigator.userAgent||""; const isiOS=/iP(hone|ad|od)/i.test(ua);
  const dob=document.getElementById("dob"); if(!dob) return;
  if(isiOS){ dob.type="text"; dob.placeholder="YYYY-MM-DD"; dob.maxLength=10;
    dob.addEventListener("input",(e)=>{
      let v=e.target.value.replace(/\D/g,"").slice(0,8);
      if(v.length>=5) v=v.slice(0,4)+"-"+v.slice(4);
      if(v.length>=8) v=v.slice(0,7)+"-"+v.slice(7);
      e.target.value=v;
    });
    dob.addEventListener("blur",()=>{ if(!/^\d{4}-\d{2}-\d{2}$/.test(dob.value)) dob.value=""; });
  }
})();

// ===== Language texts =====
const TEXT={
  ja:{
    title:"KenGoSystem ‚Äî „Éï„Ç°„É≥„Çø„Ç∏„ÉºÁîüÂπ¥ÊúàÊó•Ë®∫Êñ≠",
    subtitle:"È¢®„ÉªÂÜÜ„Éª„Ç¥„É†„ÅÆ‰∏âÁ≤æ„Çí„Éô„Éº„Çπ„Å´„ÄÅ„ÅÇ„Å™„Åü„ÅÆ‚ÄúÂèØÊÑõ„ÅÑÂ±ûÊÄß‚Äù„ÇíÂç†„ÅÜ„Çà„ÄÇ",
    name:"„Éã„ÉÉ„ÇØ„Éç„Éº„É†", birth:"ÁîüÂπ¥ÊúàÊó•",
    tip1:"Á´ØÊú´Ë®ÄË™û„Å´Ëá™ÂãïÂØæÂøú", tip2:"ÈùûÂº∑Âà∂„ÉªÂ§ñËº™„Çµ„Éù„Éº„Éà", tip3:"ÂÄã‰∫∫„ÅÆÊ†∏„ÅØ‰∏çÂèØ‰æµ",
    btn:"Ë®∫Êñ≠„Åô„Çã",
    result:"Ë®∫Êñ≠ÁµêÊûú",
    tag:(r)=>`Â±ûÊÄßÔºö${r.coreName}ÔΩúÊµÅ„ÇåÔºö${r.flowName}ÔΩúÂΩ¢Ôºö${r.formName}`,
    core:(r)=>`<b>${r.coreEmoji} ${r.coreName}</b> ‚Äî „Åç„Åø„ÅÆ‚ÄúÊ†∏‚Äù„ÅØ„Åì„ÅÆÂ±ûÊÄßÔºÅ „Å©„Çì„Å™Ë°ùÊíÉ„ÇÇ„Å∑„Å´„Å£„Å®Âèó„ÅëÊ≠¢„ÇÅ„ÄÅ„ÇÑ„Çè„Çâ„Åã„ÅèË∑≥„Å≠Ëøî„Åô‰ΩìË≥™„ÄÇÁÑ°ÁêÜ„Å´Â§â„Çè„Çç„ÅÜ„Å®„Åõ„Åö„ÄÅ„ÅÑ„Åæ„ÅÆ‰∏∏„Åï„ÇíÂèØÊÑõ„Åå„Å£„Å¶‚óé`,
    flow:(r)=>`<b>‰ªäÊó•„ÅÆÈ¢®Âêë„ÅçÔºö</b> ${r.flowEmoji} ${r.flowName}„ÄÇÂëºÂê∏„ÇíÂêà„Çè„Åõ„Çã„Åª„Å©‰∏ñÁïå„Åå„Çπ„É†„Éº„Ç∫„ÄÇÊ∑±ÂëºÂê∏‚Üí„ÇÜ„Å£„Åè„Çä‰∏ÄÊ≠©„ÅßÈ≠îÊ≥ï„ÅåÁô∫Âãï„Åô„Çã„Çà„ÄÇ`,
    form:(r)=>`<b>Ë¶ã„ÅüÁõÆ„ÅÆ„Ç™„Éº„É©Ôºö</b> ${r.formEmoji} ${r.formName}„ÄÇÂßøÂã¢„Çí„Å°„Çá„Å£„Å®Êï¥„Åà„Çã„Å®„Ç≠„É©Â∫¶„Åå+1„ÄÇËÇ©„Å®È¶ñ„Çí‚Äú„Åè„Çã„ÇäÂÜÜ‚Äù„ÅßÂõû„Åô„Å®Âêâ‚ô™`,
    shareTitle:"„Ç∑„Çß„Ç¢Ôºè„É™„É≥„ÇØ",
    shareBtn:"„É™„É≥„ÇØ„Çí„Ç≥„Éî„Éº / ÂÖ±Êúâ",
    empty:"ÁîüÂπ¥ÊúàÊó•„ÇíÂÖ•Âäõ„Åó„Å¶„Å≠",
    disclaimer:"‚ÄªKenGoSystem„ÅÆÂéüÂâáÔºöÊäº„Åï„Å™„ÅÑ„ÉªÂ∞é„Åã„Å™„ÅÑ„Éª„ÇÑ„Åï„Åó„ÅèÊï¥„Åà„Çã„ÄÇË°®Á§∫„ÅØËªΩÈáèË®∫Êñ≠„Åß„Åô„ÄÇ"
  },
  en:{
    title:"KenGoSystem ‚Äî Fantasy Birthdate Analyzer",
    subtitle:"Based on Wind ‚Ä¢ Circle ‚Ä¢ Rubber spirits, we reveal your cute fantasy vibe.",
    name:"Nickname", birth:"Birthdate",
    tip1:"Auto language by device", tip2:"Non-force outer wind", tip3:"Core is inviolable",
    btn:"Analyze",
    result:"Your Fantasy Result",
    tag:(r)=>`Affinity: ${r.coreName} | Flow: ${r.flowName} | Form: ${r.formName}`,
    core:(r)=>`<b>${r.coreEmoji} ${r.coreName}</b> ‚Äî Your inner ‚Äúcore‚Äù loves to absorb bumps and bounce back softly. No need to force change‚Äîpamper that roundness ‚ú®`,
    flow:(r)=>`<b>Today's breeze:</b> ${r.flowEmoji} ${r.flowName}. Match your breath and pace‚Äîone gentle step triggers the magic.`,
    form:(r)=>`<b>Aura form:</b> ${r.formEmoji} ${r.formName}. Tiny posture tune (shoulders/neck in a soft circle) boosts sparkle +1.`,
    shareTitle:"Share / Link",
    shareBtn:"Copy / Share link",
    empty:"Please enter your birthdate",
    disclaimer:"*KenGoSystem principle: no push, no lead‚Äîonly gentle alignment. Lightweight readout."
  }
};
const L=TEXT[window.APP_LANG||"ja"];

// ===== UI text set =====
document.getElementById("title").innerText=L.title;
document.getElementById("subtitle").innerText=L.subtitle;
document.getElementById("label_name").innerText=L.name;
document.getElementById("label_birth").innerText=L.birth;
document.getElementById("tip1").innerText=L.tip1;
document.getElementById("tip2").innerText=L.tip2;
document.getElementById("tip3").innerText=L.tip3;
document.getElementById("run").innerText=L.btn;
document.getElementById("result_title").innerText=L.result;
document.getElementById("share_title").innerText=L.shareTitle;
document.getElementById("disclaimer").innerText=L.disclaimer;

// Auto fill from query (?d=YYYY-MM-DD&n=Name)
(function autoFill(){
  const qs=new URLSearchParams(location.search);
  const d=qs.get("d"); const n=qs.get("n");
  if(n) document.getElementById("name").value=decodeURIComponent(n);
  if(d) document.getElementById("dob").value=d;
})();

// ===== Fantasy dictionaries =====
const CORE_NAMES={
  ja:["ÂÜÜÁí∞„ÅÆË≥¢ËÄÖ","È¢®„ÅÆÂ¶ñÁ≤æ","„Ç¥„É†„ÅÆÂÆà„ÇäÊâã"],
  en:["Circle Sage","Wind Sprite","Elastic Guardian"]
};
const CORE_EMOJI=["üü°","üå¨Ô∏è","ü´ß"];

const FLOW_WEEK_JA=[
  ["Êó•Ëº™„ÅÆÈùôÊ∞¥","ü´ß"],["ÊúàÂÖâ„ÅÆ‰∏äÊòá","üåô"],["ÊòüÂ∑°„Çä„ÅÆÂæ™Áí∞","üåÄ"],
  ["ÈôΩÁÇé„ÅÆÂä†ÈÄü","‚ö°"],["Áæ§Èùí„ÅÆÂçîË™ø","ü§ù"],["ÂâµÊòü„ÅÆ„Å≤„Çâ„ÇÅ„Åç","‚ú®"],["‰ΩôÁôΩ„ÅÆÈ≠îÊ≥ï","üåø"]
];
const FLOW_WEEK_EN=[
  ["Solar Stillness","ü´ß"],["Moonrise Lift","üåô"],["Stellar Loop","üåÄ"],
  ["Sunflare Boost","‚ö°"],["Cobalt Sync","ü§ù"],["Creative Spark","‚ú®"],["Magic of Margin","üåø"]
];

const FORM_MAP_JA=[
  ["Èõ≤Ëº™Ôºà„Åµ„Çè„Åµ„ÇèÂÜÜÔºâ","‚òÅÔ∏è"],["Ê∏¶Ëº™Ôºà„Åè„Çã„Çä„ÇìÊ≥¢Ôºâ","üåÄ"]
];
const FORM_MAP_EN=[
  ["Cloud Ring (fluffy)","‚òÅÔ∏è"],["Vortex Ring (swirly)","üåÄ"]
];

// ===== Analyzer =====
function analyze(dstr){
  if(!/^\d{4}-\d{2}-\d{2}$/.test(dstr)) return null;
  const y=+dstr.slice(0,4), m=+dstr.slice(5,7)-1, d=+dstr.slice(8,10);
  const sum=dstr.replace(/\D/g,"").split("").reduce((s,c)=>s+ +c,0);
  const coreIdx=sum%3;
  const coreName=(window.APP_LANG==="ja"?CORE_NAMES.ja:CORE_NAMES.en)[coreIdx];
  const coreEmoji=CORE_EMOJI[coreIdx];

  const dt=new Date(y,m,d); const wd=dt.getDay();
  const FARR=window.APP_LANG==="ja"?FLOW_WEEK_JA:FLOW_WEEK_EN;
  const [flowName,flowEmoji]=FARR[wd];

  const formSeed=y%100; const pair=window.APP_LANG==="ja"?FORM_MAP_JA:FORM_MAP_EN;
  const [formName,formEmoji]=pair[formSeed%2];

  // Cute core emoji pick for heading
  const head = coreIdx===0?"üîÆ":(coreIdx===1?"üçÉ":"üç¨");

  return {coreName, coreEmoji, flowName, flowEmoji, formName, formEmoji, head};
}

// ===== Share helpers =====
function attachShare(url){
  const a=document.getElementById("share");
  a.textContent=L.shareBtn; a.href=url.toString();
  a.onclick=async(e)=>{
    e.preventDefault();
    try{ if(navigator.share){ await navigator.share({title:"KenGoSystem", url:url.toString()}); return; } }catch(_){}
    try{
      await navigator.clipboard.writeText(url.toString());
      a.textContent=(window.APP_LANG==="ja")?"„Ç≥„Éî„Éº„Åó„Åü„ÇàÔºÅ":"Copied!";
      setTimeout(()=>a.textContent=L.shareBtn,1600);
    }catch(_){ location.href=url.toString(); }
  };
}

// ===== Run =====
document.getElementById("run").addEventListener("click",()=>{
  const name=(document.getElementById("name").value||"Guest").trim();
  const dob=(document.getElementById("dob").value||"").trim();
  if(!dob){ alert(L.empty); return; }
  const r=analyze(dob); if(!r){ alert(L.empty); return; }

  document.getElementById("emoji_core").textContent=r.head;
  document.getElementById("summary_tag").textContent=L.tag(r);
  document.getElementById("line_core").innerHTML=L.core(r);
  document.getElementById("line_flow").innerHTML=L.flow(r);
  document.getElementById("line_form").innerHTML=L.form(r);

  const out=document.getElementById("out"); out.style.display="block";

  // Make shareable link (?d=...&n=...&lang=..)
  const url=new URL(location.href.split("#")[0]);
  url.search=""; url.searchParams.set("d",dob);
  url.searchParams.set("n",encodeURIComponent(name));
  url.searchParams.set("lang",window.APP_LANG);
  document.getElementById("shareurl").textContent=url.toString();
  attachShare(url);
});

// focus tweak
["name","dob"].forEach(id=>{
  const el=document.getElementById(id);
  el && el.addEventListener("focus",()=>setTimeout(()=>window.scrollBy(0,-40),80));
});
</script>
</body>
</html>