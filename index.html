<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>KenGo式 人格OSカード｜Birthdate Only</title>
<meta name="theme-color" content="#f5fbff">
<style>
/* ====== COLOR PALETTE (Bright / Clear Sky) ====== */
:root{
  --sky:#eaf7ff; --sky2:#f5fbff; --sun:#ffd86b; --ink:#0e1a2b;
  --line:#e7eef5; --leaf:#2dba7a; --ocean:#3c83d3; --rose:#c24b7f; --vio:#6a5acd;
  --gold:#d4b44c; --paper:#ffffff; --mut:#6f7c8f;
}

/* ====== RESET ====== */
*{box-sizing:border-box}
html,body{height:100%;margin:0}
body{
  font-family: "Inter","Noto Sans JP", system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
  color:var(--ink); background:
   radial-gradient(1200px 600px at 50% -80px, #ffffff 0%, var(--sky2) 55%, var(--sky) 100%);
}

/* subtle world map + world tree motif (pure CSS/SVG) */
.bg{
  position:fixed; inset:0; pointer-events:none; opacity:.12; mix-blend-mode:multiply;
  background:
    url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="1400" height="800" viewBox="0 0 1400 800"><g fill="none" stroke="%23bcd7f2" stroke-width="1"><path d="M0,400 Q350,150 700,400 T1400,400" /><path d="M0,420 Q350,170 700,420 T1400,420" /><circle cx="700" cy="420" r="260"/><circle cx="700" cy="420" r="360"/></g><g fill="none" stroke="%23bcd7f2" stroke-width="0.8" opacity="0.75"><path d="M180,350c60-40,120-50,180-20c70,35,100,120,70,170c-20,32-70,50-120,30c-44-17-96-73-130-180z"/><path d="M1080,360c80-20,150,10,190,70c30,44,20,100-30,120c-40,16-86,5-120-30c-40-42-50-96-40-160z"/></g></svg>') center/cover no-repeat;
}

/* ====== LAYOUT ====== */
.wrap{max-width:960px;margin:0 auto;padding:20px 14px}
.header{display:flex;justify-content:space-between;align-items:center;margin:4px 0 14px}
.brand{display:flex;align-items:center;gap:12px}
.logo{
  font-weight:900; letter-spacing:.2px; font-size:18px; padding:6px 10px; border-radius:999px;
  background:linear-gradient(90deg,#fff8d9,#fff); border:1px solid var(--gold); color:#7a5a00;
}
.title{font-weight:900;font-size:22px;}

/* Crown effect for name block */
.crown{
  display:inline-grid; place-items:center; position:relative; padding:6px 12px;
  border:1.5px solid var(--line); border-radius:12px; background:#fff;
}
.crown:before{
  content:""; position:absolute; top:-10px; left:50%; width:46px; height:26px; transform:translateX(-50%);
  background:
    radial-gradient(12px 8px at 8px 16px, var(--gold), transparent 70%),
    radial-gradient(12px 8px at 24px 8px, var(--gold), transparent 70%),
    radial-gradient(12px 8px at 38px 16px, var(--gold), transparent 70%);
  filter:drop-shadow(0 1px 0 #bda449);
}

/* Card */
.card{
  background:var(--paper); border:1px solid var(--line); border-radius:16px; padding:14px;
  box-shadow: 0 8px 20px rgba(28,78,128,.06);
}
.note{color:var(--mut);font-size:12px}

/* Forms */
.grid{display:grid; gap:12px}
@media(min-width:900px){ .grid2{grid-template-columns:1fr 1fr} }
label{font-size:13px; font-weight:700; color:#2d3a50}
.input,select,button{
  width:100%; font:inherit; border-radius:12px; border:1.5px solid var(--line); padding:12px 12px; background:#fff;
}
.input::placeholder{color:#9fb2c8}
select{background:#fff}
.btn{
  font-weight:900; color:#0c2a49; background:linear-gradient(180deg,#ffffff,#f1f7ff);
  border-color:#bcd7f2;
}
.btn:active{transform:translateY(1px)}
.err{color:#b1003b;font-size:12px;display:none}

/* Tabs */
.tabs{display:flex; gap:8px; margin-top:8px; flex-wrap:wrap}
.tab{flex:1 1 140px; text-align:center; font-weight:900; padding:10px; border:1px solid var(--line); border-radius:12px; background:#fff; cursor:pointer}
.tab.on{border-color:#9fc8ff; background:#f3f9ff}

/* Bars */
.stat{display:grid; grid-template-columns:120px 1fr 60px; gap:10px; align-items:center}
.bar{height:14px; background:#edf4fb; border:1px solid var(--line); border-radius:10px; overflow:hidden}
.fill{height:100%; width:0; transition:width .5s ease; background:linear-gradient(90deg,#9bd2ff,#49b3ff)}
.pct{text-align:right; font-variant-numeric:tabular-nums}

/* Six */
.row{display:grid;grid-template-columns:120px 1fr 48px; gap:8px; align-items:center}
.thin{height:10px; background:#f6fbff; border:1px solid var(--line); border-radius:8px; overflow:hidden}
.tfill{height:100%; width:0; transition:width .5s ease; background:linear-gradient(90deg,#79d2b4,#2dba7a)}

/* Element tag */
.elem{display:inline-flex; align-items:center; gap:8px; border:1px solid var(--line); border-radius:999px; padding:6px 12px; font-weight:900; background:#ffffff}
.dot{width:10px;height:10px;border-radius:999px}
.wind{background:#33b3ff} .fire{background:#ff784d} .earth{background:#c79b4a} .water{background:#44c6c9}

/* Greats */
.great{display:flex;justify-content:space-between;align-items:center; padding:8px 10px; border:1px solid var(--line); border-radius:12px; margin:6px 0; background:#fff}
.gname{font-weight:800}
.gpct{font-weight:900}

/* Toast */
.toast{
  position:fixed; left:50%; top:12px; transform:translateX(-50%) translateY(-12px);
  background:#fff; border:1px solid var(--line); border-radius:12px; padding:8px 12px; opacity:0; transition:.35s; z-index:10; font-weight:900
}
.toast.in{opacity:1; transform:translateX(-50%)}

/* Result panel */
.panel{border:1px solid var(--line); border-radius:16px; padding:12px; background:#fff; margin-top:8px}
.kv{display:grid; grid-template-columns:104px 1fr; gap:12px; align-items:center}
.mon{
  width:104px; height:104px; border-radius:16px; border:1px solid var(--line); display:grid; place-items:center; font-weight:900; font-size:38px; color:#0c2a49;
  background: conic-gradient(from 0deg, #fff 0 70%, #ffeeb9 70% 100%), radial-gradient(100% 120% at 50% 0%, #fff 0, #fff 60%, #fff6cc 61%, #fff 70%);
}

/* Share */
.actions{display:flex; gap:8px; flex-wrap:wrap}
.share{background:linear-gradient(180deg,#fff,#fff8d9); border:1.5px solid var(--gold); color:#6e5600}

/* Footer */
.footer{color:var(--mut); font-size:12px; text-align:center; margin:16px 0 8px}
</style>
</head>
<body>
<div class="bg" aria-hidden="true"></div>
<div id="toast" class="toast">カードを生成しました。</div>

<div class="wrap">
  <div class="header">
    <div class="brand">
      <div class="logo">IKI</div>
      <div class="title">KenGo式 人格OSカード（Birthdate Only）</div>
    </div>
  </div>

  <!-- ===== INPUT ===== -->
  <div class="card grid grid2" id="form">
    <div>
      <label>生年月日（必須｜YYYYMMDD か YYYY-MM-DD）</label>
      <input id="birth" class="input" inputmode="numeric" placeholder="1990-05-04 / 19900504">
      <div id="err" class="err">日付の形式が正しくありません。</div>
    </div>
    <div>
      <label>物語（任意・雰囲気だけ）</label>
      <select id="story">
        <option value="std">標準（KenGo式）</option>
        <option value="one">海の冒険（悪魔の実）</option>
        <option value="ninja">忍の道（術）</option>
        <option value="slayer">呼吸の剣（型）</option>
        <option value="db">気と覚醒（奥義）</option>
        <option value="dq">勇者譚（呪文/職業）</option>
        <option value="hxh">念能力（系統）</option>
        <option value="ghibli">ジブリ（精霊気質）</option>
        <option value="disney">Disney（アーキタイプ）</option>
        <option value="marvel">MARVEL（資質）</option>
        <option value="myth">世界神話（属性）</option>
      </select>
      <div class="note">※ “演出”にだけ使う。診断の芯は生年月日のみ。</div>
    </div>
    <div style="grid-column:1/-1; display:flex; gap:10px; align-items:center">
      <button id="gen" class="btn">ゲームスタート（診断する）</button>
      <div class="note">一瞬で完了。iPhoneでもOK。</div>
    </div>
  </div>

  <!-- ===== RESULT ===== -->
  <div id="result" class="grid grid2" style="margin-top:12px; display:none">
    <div class="card">
      <div class="kv">
        <div class="mon" id="mon">◎</div>
        <div>
          <div class="crown" id="osName">OS: —</div>
          <div style="margin-top:8px">
            <span class="elem"><span class="dot wind" id="dot"></span><span id="elemText" style="font-weight:900">—</span></span>
            <span class="elem" style="margin-left:6px"><span id="colorText" style="font-weight:900">—</span></span>
          </div>
          <div class="note" id="mythoText" style="margin-top:6px">—</div>
        </div>
      </div>

      <div class="panel">
        <div class="stat"><div>安定（HP）</div><div class="bar"><div id="hp" class="fill"></div></div><div id="hpv" class="pct">—%</div></div>
        <div class="stat"><div>視点（MP）</div><div class="bar"><div id="mp" class="fill" style="background:linear-gradient(90deg,#bfe3ff,#3c83d3)"></div></div><div id="mpv" class="pct">—%</div></div>
        <div class="stat"><div>機動（SP）</div><div class="bar"><div id="sp" class="fill" style="background:linear-gradient(90deg,#a9f0d2,#2dba7a)"></div></div><div id="spv" class="pct">—%</div></div>
      </div>

      <div class="panel" id="sixPanel">
        <div class="row"><div>円</div><div class="thin"><div id="t0" class="tfill"></div></div><div id="v0" class="pct">—%</div></div>
        <div class="row"><div>風</div><div class="thin"><div id="t1" class="tfill" style="background:linear-gradient(90deg,#8ed5ff,#49b3ff)"></div></div><div id="v1" class="pct">—%</div></div>
        <div class="row"><div>核</div><div class="thin"><div id="t2" class="tfill" style="background:linear-gradient(90deg,#ffd86b,#ffb700)"></div></div><div id="v2" class="pct">—%</div></div>
        <div class="row"><div>間</div><div class="thin"><div id="t3" class="tfill" style="background:linear-gradient(90deg,#d5dcff,#6a5acd)"></div></div><div id="v3" class="pct">—%</div></div>
        <div class="row"><div>和</div><div class="thin"><div id="t4" class="tfill" style="background:linear-gradient(90deg,#ffe2ef,#c24b7f)"></div></div><div id="v4" class="pct">—%</div></div>
        <div class="row"><div>返</div><div class="thin"><div id="t5" class="tfill" style="background:linear-gradient(90deg,#bde8ff,#00bcd4)"></div></div><div id="v5" class="pct">—%</div></div>
      </div>

      <div class="actions" style="margin-top:8px">
        <button id="share" class="btn share">結果をシェア</button>
      </div>
    </div>

    <div>
      <div class="card">
        <div class="tabs">
          <div id="tabS" class="tab on">専用カード</div>
          <div id="tabG" class="tab">歴史OS 一致度（Top3）</div>
        </div>

        <div id="panS" class="panel">
          <p class="note" id="storyBlock">—</p>
          <ul id="skills" style="margin:8px 0 0 18px; padding:0"></ul>
        </div>

        <div id="panG" class="panel" style="display:none">
          <div id="greats"></div>
          <div class="note">※ 歴史考証ではなく「OSの雰囲気の近さ」推定。</div>
        </div>
      </div>

      <div class="footer">© KenGo System — “Respect the Core · Support the Flow · Match the Circle · Never Force.”</div>
    </div>
  </div>
</div>

<script>
/* ===== Utils ===== */
const $=id=>document.getElementById(id);
const toast=(t)=>{const el=$("toast"); el.textContent=t; el.classList.add("in"); setTimeout(()=>el.classList.remove("in"),1600);};
function parseDate(v){
  if(!v) return null; v=v.trim();
  if(/^\d{8}$/.test(v)){const y=+v.slice(0,4),m=+v.slice(4,6)-1,d=+v.slice(6,8);
    const dt=new Date(Date.UTC(y,m,d)); if(dt&&dt.getUTCFullYear()===y&&dt.getUTCMonth()===m&&dt.getUTCDate()===d)return dt;}
  const vv=v.replace(/\//g,"-"); if(/^\d{4}-\d{2}-\d{2}$/.test(vv)){
    const [y,m,d]=vv.split("-").map(Number); const dt=new Date(Date.UTC(y,m-1,d));
    if(dt&&dt.getUTCFullYear()===y&&dt.getUTCMonth()===m-1&&dt.getUTCDate()===d)return dt;}
  return null;
}
function rngFromDate(dt){ let s = dt.getUTCFullYear()*10000+(dt.getUTCMonth()+1)*100+dt.getUTCDate();
  s = (s ^ 0x9e3779b9)>>>0; return ()=> (s = Math.imul(1664525,s)+1013904223>>>0) / 2**32; }

/* ===== Six indicators (Circle, Wind, Core, Interval, Harmony, Return) ===== */
function six(dt){
  const R=rngFromDate(dt), w=dt.getUTCDay(), m=dt.getUTCMonth()+1;
  return Array.from({length:6},(_,i)=>{
    const base=0.55+R()*0.28;
    const twist=((w+i)%3===0?0.05:0)+((m%6===i?0.04:0))+(R()-0.5)*0.06;
    return Math.max(0,Math.min(1,base+twist))*100|0;
  });
}
function baseStats(s){ return {
  hp:Math.round(s[0]*0.5 + s[2]*0.3 + s[5]*0.2),
  mp:Math.round(s[3]*0.5 + s[4]*0.3 + s[2]*0.2),
  sp:Math.round(s[1]*0.6 + s[3]*0.25 + s[4]*0.15)
};}

/* ===== Element / Color / Myth assignment (hashed from date) ===== */
const COLORS = [
  {key:"Azure Gold", jp:"蒼金", desc:"空と芯の太陽。外側で風を動かし、内側で核を温める色。"},
  {key:"Verdant Jade", jp:"翠玉", desc:"大地の再生と静かな循環。"},
  {key:"Crimson Spark", jp:"緋火", desc:"突破と反転の火。"},
  {key:"Moonlit Silver", jp:"月白", desc:"間と返を研ぎ澄ます静光。"}
];
const MYTHS = [
  {key:"日本神話 × ケルト循環", jp:"天と風を円で結ぶ。再生に強い。"},
  {key:"北欧神話 × 海の路", jp:"秩序と冒険を往復させる。"},
  {key:"ギリシャ神話 × 叡智", jp:"間合いと翻訳の才。"},
  {key:"エジプト神話 × 太陽核", jp:"核の守護と再帰。"}
];
function elementFromSix(s){
  const score = {
    wind: s[1]*0.6 + s[3]*0.4,
    fire: s[5]*0.6 + s[1]*0.4,
    earth: s[2]*0.6 + s[0]*0.4,
    water: s[4]*0.7 + s[0]*0.3
  };
  const key = Object.entries(score).sort((a,b)=>b[1]-a[1])[0][0];
  const label = {wind:"WIND（風）", fire:"FIRE（火）", earth:"EARTH（地）", water:"WATER（水）"}[key];
  return {key,label};
}

/* ===== Story render (optional flavor) ===== */
const STORY = {
  std: d=>["専用カード（標準）",
    "・“受け返し”が核。痛み→素材→反転の才能。",
    "・円を先に置くと景色が澄む。","・判断の奪い合いを避け、間で勝つ。"],
  one: d=>["海の冒険（悪魔の実）",
    "・あなたに合う実：『風輪（ウィンドリング）の実』— 空気と円を操る。",
    "・相性MAX：『ゴム』— 衝撃を受けて跳ね返す（折れない核）。",
    "・現実の修行：深呼吸→一拍おく→一歩踏み出す。"],
  ninja: d=>["忍の道（術）",
    "・適性：『間合い術』＋『風走』。","・呼吸で速度を決め、一拍遅らせて抜く。","・“見立て”で勝つ。"],
  slayer: d=>["呼吸の剣（型）",
    "・得意：『返の型』— 受けて反転。","・“核”で立ち、“間”で抜く。"],
  db: d=>["気と覚醒（奥義）",
    "・資質：『界王円（サークル・ブースト）』","・気の収束→一気に解放。"],
  dq: d=>["勇者譚（呪文/職業）",
    "・職：『賢者（風）』／補助最適化。","・呪文：バフ系は“間”を作ると最大化。"],
  hxh: d=>["念能力（系統）",
    "・系統：変化 × 放出 の中間。","・“空気”と“返し”の二刀流。"],
  ghibli: d=>["ジブリ（精霊気質）",
    "・気配：風・森の調停者。","・“橋”をかけるほど場が整う。"],
  disney: d=>["Disney（アーキタイプ）",
    "・型：『風の案内人』。","・歌＝呼吸、ダンス＝間。"],
  marvel: d=>["MARVEL（資質）",
    "・資質：バリア＋反射。","・守って返す。"],
  myth: d=>["世界神話（属性）",
    "・円の守護×太陽の核。","・再生と翻訳。"]
};

/* ===== Famous figures (OS vibe) ===== */
const GREATS = [
  "徳川家康","織田信長","豊臣秀吉","宮本武蔵","紫式部","坂本龍馬",
  "西郷隆盛","卑弥呼","聖徳太子","渋沢栄一","ナポレオン","レオナルド・ダ・ヴィンチ",
  "ガンジー","ジャンヌ・ダルク","クレオパトラ","ニュートン","アインシュタイン","マザーテレサ"
];
function topGreats(dt, s){
  const R = rngFromDate(dt);
  const picks = [];
  const used = new Set();
  for(let k=0;k<3;k++){
    let idx = Math.floor(R()*GREATS.length);
    while(used.has(idx)) idx = (idx+1)%GREATS.length;
    used.add(idx);
    const base = 72 + Math.floor(R()*24); // 72–95%
    // nudge: if “核”高い→家康寄り、風高い→龍馬/ダヴィンチ寄り…軽い味付け
    const bonus = (GREATS[idx]==="徳川家康" && s[2]>s[1]?3:0)
                + (GREATS[idx]==="坂本龍馬" && s[1]>s[2]?3:0)
                + (GREATS[idx]==="レオナルド・ダ・ヴィンチ" && s[3]>70?2:0);
    picks.push({name:GREATS[idx], pct: Math.min(99, base+bonus)});
  }
  // sort desc
  return picks.sort((a,b)=>b.pct-a.pct);
}

/* ===== OS Name generator (no nickname) ===== */
function osName(s){
  const keys=["円","風","核","間","和","返"];
  const idx = s.indexOf(Math.max(...s));
  const head = ["Circle","Wind","Core","Interval","Harmony","Return"][idx];
  return `KenGo OS — ${head} Type`;
}

/* ===== Render ===== */
function render(dt, storyKey){
  const s = six(dt);
  const stats = baseStats(s);
  // element/color/myth
  const el = elementFromSix(s);
  const R = rngFromDate(dt);
  const col = COLORS[Math.floor(R()*COLORS.length)];
  const myth = MYTHS[Math.floor(R()*MYTHS.length)];

  // name + badges
  $("osName").textContent = osName(s);
  $("elemText").textContent = el.label;
  $("dot").className = "dot " + ({WIND:"wind","WIND（風）":"wind",FIRE:"fire","FIRE（火）":"fire",EARTH:"earth","EARTH（地）":"earth",WATER:"water","WATER（水）":"water"}[el.label]||"wind");
  $("colorText").textContent = `COLOR: ${col.key}（${col.jp}）`;
  $("mythoText").textContent = `MYTHO: ${myth.key} — ${myth.jp}`;

  // bars
  const setBar=(id,val,txt)=>{$(id).style.width=val+"%"; $(txt).textContent=val+"%";};
  setBar("hp",stats.hp,"hpv"); setBar("mp",stats.mp,"mpv"); setBar("sp",stats.sp,"spv");
  for(let i=0;i<6;i++){ $("t"+i).style.width=s[i]+"%"; $("v"+i).textContent=s[i]+"%"; }

  // story flavor
  const block = STORY[storyKey] ? STORY[storyKey](dt) : STORY.std(dt);
  $("storyBlock").textContent = block[0];
  const ul = $("skills"); ul.innerHTML="";
  block.slice(1).forEach(t=>{ const li=document.createElement("li"); li.textContent=t; ul.appendChild(li); });

  // greats
  const gs = topGreats(dt, s);
  const gBox = $("greats"); gBox.innerHTML="";
  gs.forEach(g=>{
    const row = document.createElement("div"); row.className="great";
    const n = document.createElement("div"); n.className="gname"; n.textContent = g.name;
    const p = document.createElement("div"); p.className="gpct"; p.textContent = g.pct + "%";
    row.appendChild(n); row.appendChild(p); gBox.appendChild(row);
  });

  // show result
  $("result").style.display="grid";
  window.scrollTo({top:document.querySelector(".wrap").offsetTop, behavior:"smooth"});
}

/* ===== Tabs ===== */
$("tabS").onclick=()=>{ $("tabS").classList.add("on"); $("tabG").classList.remove("on"); $("panS").style.display="block"; $("panG").style.display="none"; };
$("tabG").onclick=()=>{ $("tabG").classList.add("on"); $("tabS").classList.remove("on"); $("panG").style.display="block"; $("panS").style.display="none"; };

/* ===== Generate ===== */
$("gen").onclick=()=>{
  const dt = parseDate($("birth").value);
  if(!dt){ $("err").style.display="block"; return; } else { $("err").style.display="none"; }
  render(dt, $("story").value);
  toast("カードを生成しました。");
};

/* ===== Share ===== */
$("share").onclick=async()=>{
  try{
    const txt = `${$("osName").textContent}\n${$("elemText").textContent} / ${$("colorText").textContent}\n${$("mythoText").textContent}`;
    if(navigator.share){ await navigator.share({title:"KenGo式 人格OSカード", text:txt}); }
    else { await navigator.clipboard.writeText(txt); toast("内容をコピーしました。"); }
  }catch(e){ toast("シェアをキャンセルしました。"); }
};
</script>
</body>
</html>