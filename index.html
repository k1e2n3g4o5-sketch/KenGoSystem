<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>KenGoå¼ï¼šé¢¨Ã—å††Ã—ã‚´ãƒ  è¨ºæ–­ï¼ˆ6å¼ï¼…ãƒ»å††ç’°å¯è¦–åŒ–ã¤ãï¼‰</title>
<meta name="color-scheme" content="light dark" />
<meta name="description" content="KenGoå¼ Elastic Human OSï¼ˆé¢¨Ã—å††Ã—ã‚´ãƒ ï¼‰ç°¡æ˜“è¨ºæ–­ã€‚6å¼ã‚’ï¼…ã§è¡¨ç¤ºãƒ»ç›¸æ€§ã®å††ç’°å¯è¦–åŒ–ã€‚iPhoneæœ€é©åŒ–ã€‚">
<style>
:root{
  --bg:#f7f8fa; --ink:#0b1220; --sub:#5a6a86; --card:#ffffff; --line:#e5e9f2;
  --acc:#2dd4bf; --acc2:#60a5fa; --bad:#ef476f; --ok:#16a34a;
  --wind:#22d3ee; --fire:#fb7185; --water:#60a5fa; --earth:#a3e635;
  --bar:#dbe4f3;
}
@media (prefers-color-scheme: dark){
  :root{
    --bg:#0b0e12; --ink:#eaf2ff; --sub:#9bb1cc; --card:#121722; --line:#1f2a3c;
    --acc:#2dd4bf; --acc2:#60a5fa; --bad:#ff8fa6; --ok:#4ade80;
    --bar:#203048;
  }
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0; background:var(--bg); color:var(--ink);
  font-family: ui-sans-serif,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial;
  -webkit-text-size-adjust:100%; line-height:1.6; font-size:18px;
}
.wrap{padding:20px}
.card{
  background:var(--card); border:1px solid var(--line); border-radius:18px;
  padding:20px; max-width:860px; margin:16px auto;
}
h1{font-size:24px; margin:0 0 6px}
.lead{color:var(--sub); margin:0 0 10px}
.kv{display:flex; gap:10px; align-items:center; flex-wrap:wrap}
.kv .big{font-size:30px}
.grid{display:grid; grid-template-columns:1fr; gap:14px; margin: 12px 0}
@media (min-width:860px){ .grid{grid-template-columns:1fr 1fr} }
label{display:block; margin: 10px 4px 6px; font-size:18px}
.input{
  width:100%; padding:14px 16px; border-radius:14px;
  border:1.5px solid var(--line); background:transparent; color:var(--ink);
  font-size:18px; min-height:52px;
}
.input::placeholder{color:var(--sub)}
.input:focus{outline:none; border-color:var(--acc2); box-shadow:0 0 0 3px color-mix(in oklab, var(--acc2) 20%, transparent)}
.hint{font-size:14px; color:var(--sub); margin:6px 4px 0}
.err{font-size:14px; color:var(--bad); margin:6px 4px 0; display:none}
button{
  width:100%; min-height:56px; padding:14px 16px; border:0; border-radius:14px;
  background: linear-gradient(90deg, var(--acc), var(--acc2));
  color:#001014; font-weight:800; font-size:20px; cursor:pointer; margin-top:12px;
  -webkit-tap-highlight-color: transparent;
}
button:active{transform:translateY(1px)}
.smallbtn{width:auto; min-height:44px; font-size:16px; padding:10px 12px; border-radius:10px; background:none; border:1px solid var(--line); color:var(--ink)}
.sep{height:1px; background:var(--line); margin:18px 0}
.badges{display:flex; flex-wrap:wrap; gap:8px; margin:6px 0}
.badge{border:1px solid var(--line); padding:8px 10px; border-radius:999px; font-size:16px}
.emo{font-size:20px}
.result{margin-top: 10px; padding:16px; border-radius:14px; border:1px solid var(--line); background: color-mix(in oklab, var(--card) 85%, transparent)}
h2{font-size:22px; margin: 4px 0 8px}
h3{font-size:18px; margin: 6px 0 4px}
.kawaii b{color:var(--ok)}
.tag{border:1px solid var(--line); padding:8px 10px; border-radius:12px; font-size:15px; display:inline-block; margin-right:6px; margin-bottom:6px;}
.footer{color:var(--sub); font-size:13px; margin-top: 6px}
.langtoggle{color:var(--acc2); text-decoration:underline; background:none; border:none; cursor:pointer; font-size:16px}
.center{display:flex; justify-content:center; gap:8px; flex-wrap:wrap}

/* ===== 6å¼ï¼…ãƒãƒ¼ ===== */
.six{display:grid; grid-template-columns:1fr; gap:10px; margin-top:10px}
.six-row{display:grid; grid-template-columns:120px 1fr 64px; align-items:center; gap:10px}
.six-name{font-size:14px; color:var(--sub)}
.bar{height:14px; background:var(--bar); border-radius:999px; overflow:hidden; position:relative}
.bar>i{display:block; height:100%; width:0; border-radius:999px; transition:width .7s ease}
.pct{font-variant-numeric:tabular-nums; text-align:right; font-size:14px}

/* ===== â€œé£›ã¶â€ã‚¢ãƒ‹ãƒ¡ï¼ˆçµæœï¼‰ ===== */
.fly{opacity:0; transform: translateY(12px) scale(.98); transition: all .38s cubic-bezier(.2,.8,.2,1)}
.fly.in{opacity:1; transform: translateY(0) scale(1)}

/* ===== A/B å††ç’°SVG ===== */
.ringbox{display:grid; place-items:center; padding:10px}
.ring-labels{display:flex; justify-content:center; gap:8px; flex-wrap:wrap}
.rtag{padding:6px 10px; border-radius:10px; border:1px solid var(--line); font-size:14px}
</style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <div class="kv">
        <div class="big">ğŸŒ€</div>
        <div>
          <h1 id="t_title">KenGoå¼ï¼šé¢¨ Ã— å†† Ã— ã‚´ãƒ  è¨ºæ–­</h1>
          <p class="lead" id="t_lead">ç”Ÿå¹´æœˆæ—¥ã¯ã€Œ19900504 / 1990-05-04 / 1990/05/04ã€ã€‚ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ ã¯ä»»æ„ã€‚6å¼ï¼…ã¨ç›¸æ€§ã®å††ç’°ã‚‚å‡ºã‚‹ã‚ˆã€‚</p>
          <button class="langtoggle" id="langBtn" aria-label="switch language">æ—¥æœ¬èª / English</button>
        </div>
      </div>

      <div class="grid">
        <!-- è‡ªåˆ† -->
        <div class="card" style="margin:0">
          <h3 id="t_you">ã‚ãªãŸ / You</h3>
          <label id="t_nick1">ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ ï¼ˆä»»æ„ï¼‰</label>
          <input class="input" type="text" id="nickA" placeholder="ä¾‹ï¼šKenGo / Optional" />
          <label id="t_birth1">ç”Ÿå¹´æœˆæ—¥ï¼ˆè‡ªç”±å…¥åŠ›ï¼‰</label>
          <input class="input" id="dateA" inputmode="numeric" pattern="[0-9]*" autocomplete="bday"
                 placeholder="19900504 / 1990-05-04 / 1990/05/04" />
          <div class="hint" id="t_hintA">æ•°å­—8æ¡ã€ã¾ãŸã¯åŒºåˆ‡ã‚Šã¤ãã§ã‚‚OKã€‚å…¨è§’ã‚‚è‡ªå‹•å¤‰æ›ã€‚</div>
          <div class="err" id="errA">æ—¥ä»˜ã®å½¢å¼ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚</div>
          <div class="badges">
            <span class="badge"><span class="emo">ğŸ’¨</span><span id="t_hint1">OSã‚¿ã‚¤ãƒ—ï¼ˆé¢¨Ã—å††Ã—ã‚´ãƒ ï¼‰ï¼‹6å¼ï¼…</span></span>
          </div>
          <button id="btnSelf">è¨ºæ–­ / Analyze</button>
        </div>

        <!-- ç›¸æ‰‹ï¼ˆä»»æ„ï¼‰ -->
        <div class="card" style="margin:0">
          <h3 id="t_partner">ç›¸æ€§ãƒã‚§ãƒƒã‚¯ï¼ˆä»»æ„ï¼‰ / Compatibility (Optional)</h3>
          <label id="t_nick2">ç›¸æ‰‹ã®ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ ï¼ˆä»»æ„ï¼‰</label>
          <input class="input" type="text" id="nickB" placeholder="ä¾‹ï¼šRin / Optional" />
          <label id="t_birth2">ç›¸æ‰‹ã®ç”Ÿå¹´æœˆæ—¥ï¼ˆè‡ªç”±å…¥åŠ›ï¼‰</label>
          <input class="input" id="dateB" inputmode="numeric" pattern="[0-9]*" autocomplete="bday"
                 placeholder="19940322 / 1994-03-22 / 1994/03/22" />
          <div class="hint" id="t_hintB">ä¸¡æ–¹ã‚ã‚Œã°ã€Œç›¸æ€§ï¼…ï¼‹A/Bå††ç’°ã€ã‚’è¡¨ç¤ºã€‚</div>
          <div class="err" id="errB">ç›¸æ‰‹ã®æ—¥ä»˜ã®å½¢å¼ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚</div>
          <button id="btnBoth">ç›¸æ€§ã¾ã§è¨ºæ–­ / Analyze Both</button>
        </div>
      </div>

      <div class="sep"></div>

      <!-- çµæœï¼ˆè‡ªåˆ†ï¼‰ -->
      <div class="result fly" id="selfBox" hidden>
        <h2 id="t_self_title">ã‚ãªãŸã®çµæœ / Your Result</h2>
        <div class="badges" id="selfBadges"></div>
        <p class="kawaii" id="selfText"></p>

        <h3 style="margin-top:14px" id="t_six_title">6å¼ï¼ˆå††ç’°ã®6æ–¹å‘ï¼‰ï¼…</h3>
        <div class="six" id="sixRows"></div>
      </div>

      <!-- çµæœï¼ˆç›¸æ€§ï¼‰ -->
      <div class="result fly" id="pairBox" hidden>
        <h2 id="t_pair_title">ç›¸æ€§çµæœ / Compatibility</h2>
        <div class="badges" id="pairBadges"></div>
        <p class="kawaii" id="pairText"></p>

        <div class="ringbox">
          <svg id="ring" width="240" height="240" viewBox="0 0 240 240" role="img" aria-label="Compatibility Rings">
            <!-- å††ç’°ï¼šå¤–A / å†…B -->
            <defs>
              <linearGradient id="gradA" x1="0" x2="1"><stop offset="0%" stop-color="var(--acc2)"/><stop offset="100%" stop-color="var(--wind)"/></linearGradient>
              <linearGradient id="gradB" x1="0" x2="1"><stop offset="0%" stop-color="var(--earth)"/><stop offset="100%" stop-color="var(--water)"/></linearGradient>
            </defs>
            <!-- èƒŒæ™¯å†† -->
            <circle cx="120" cy="120" r="90" stroke="var(--line)" stroke-width="12" fill="none" opacity=".6"/>
            <circle cx="120" cy="120" r="65" stroke="var(--line)" stroke-width="12" fill="none" opacity=".6"/>
            <!-- å¯å¤‰ã‚¢ãƒ¼ã‚¯ -->
            <path id="arcA" d="" stroke="url(#gradA)" stroke-width="12" fill="none" stroke-linecap="round"/>
            <path id="arcB" d="" stroke="url(#gradB)" stroke-width="12" fill="none" stroke-linecap="round"/>
            <!-- ä¸­å¤®ãƒ©ãƒ™ãƒ« -->
            <text id="ringScore" x="120" y="126" text-anchor="middle" font-size="24" fill="currentColor" font-weight="700">--%</text>
          </svg>
          <div class="ring-labels" id="ringLabels"></div>
        </div>
      </div>

      <div class="sep"></div>
      <div class="center">
        <span class="tag">ğŸ§© Elastic Human OS</span>
        <span class="tag">ğŸ’  Core = Rubber</span>
        <span class="tag">ğŸ’¨ Wind = Flow</span>
        <span class="tag">â­• Circle = Return</span>
      </div>
      <p class="footer" id="t_footer">ã‚¨ãƒ³ã‚¿ãƒ¡è¨ºæ–­ã€‚ä½“æ„Ÿï¼ˆBâ†’Aï¼‰ã‚’ãŸã®ã—ã‚“ã§ã­ã€‚/ This is for fun & reflection.</p>
    </div>
  </div>

<script>
(()=>{
  // ===== i18n =====
  const jp = {
    title:"KenGoå¼ï¼šé¢¨Ã—å††Ã—ã‚´ãƒ  è¨ºæ–­",
    lead:"ç”Ÿå¹´æœˆæ—¥ã¯ã€Œ19900504 / 1990-05-04 / 1990/05/04ã€ã€‚ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ ã¯ä»»æ„ã€‚6å¼ï¼…ã¨ç›¸æ€§ã®å††ç’°ã‚‚å‡ºã‚‹ã‚ˆã€‚",
    you:"ã‚ãªãŸ / You", nick1:"ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ ï¼ˆä»»æ„ï¼‰", birth1:"ç”Ÿå¹´æœˆæ—¥ï¼ˆè‡ªç”±å…¥åŠ›ï¼‰",
    hintA:"æ•°å­—8æ¡ã€ã¾ãŸã¯åŒºåˆ‡ã‚Šã¤ãã§ã‚‚OKã€‚å…¨è§’ã‚‚è‡ªå‹•å¤‰æ›ã€‚",
    partner:"ç›¸æ€§ãƒã‚§ãƒƒã‚¯ï¼ˆä»»æ„ï¼‰ / Compatibility (Optional)",
    nick2:"ç›¸æ‰‹ã®ãƒ‹ãƒƒã‚¯ãƒãƒ¼ãƒ ï¼ˆä»»æ„ï¼‰", birth2:"ç›¸æ‰‹ã®ç”Ÿå¹´æœˆæ—¥ï¼ˆè‡ªç”±å…¥åŠ›ï¼‰",
    hintB:"ä¸¡æ–¹ã‚ã‚Œã°ã€Œç›¸æ€§ï¼…ï¼‹A/Bå††ç’°ã€ã‚’è¡¨ç¤ºã€‚",
    hint1:"OSã‚¿ã‚¤ãƒ—ï¼ˆé¢¨Ã—å††Ã—ã‚´ãƒ ï¼‰ï¼‹6å¼ï¼…",
    btnSelf:"è¨ºæ–­ / Analyze", btnBoth:"ç›¸æ€§ã¾ã§è¨ºæ–­ / Analyze Both",
    selfTitle:"ã‚ãªãŸã®çµæœ / Your Result", pairTitle:"ç›¸æ€§çµæœ / Compatibility",
    sixTitle:"6å¼ï¼ˆå††ç’°ã®6æ–¹å‘ï¼‰ï¼…",
    footer:"ã‚¨ãƒ³ã‚¿ãƒ¡è¨ºæ–­ã€‚ä½“æ„Ÿï¼ˆBâ†’Aï¼‰ã‚’ãŸã®ã—ã‚“ã§ã­ã€‚/ This is for fun & reflection.",
    err:"æ—¥ä»˜ã®å½¢å¼ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚",
    sixNames:[
      "Circle-Beingï¼ˆäººã¯å††ï¼‰",
      "Arrow-Worldï¼ˆçŸ¢å°ä¸–ç•Œï¼‰",
      "Return-Growthï¼ˆå¯ã‚‹å­ã¯è‚²ã¤ï¼‰",
      "Top-View Identityï¼ˆä¸Šè¦–ç‚¹ã®é¡”ï¼‰",
      "Wind Outflow â†’ Returnï¼ˆé¢¨ã®å‘¼å¸ï¼‰",
      "Rubber Return Keyï¼ˆå„€å¼ï¼å¸°é‚„ã‚­ãƒ¼ï¼‰"
    ],
    compHow:"ä½¿ã„æ–¹",
    ritual:"åˆå›³ã¥ãã‚Šï¼šâ‘ åˆå›³ã®ã“ã¨ã° â‘¡ä¸€åº¦æ·±å‘¼å¸ â‘¢â€œã‚„ã£ã¨ã ã­â€"
  };
  const en = {
    title:"KenGo Method: Wind Ã— Circle Ã— Rubber â€” Typing",
    lead:"Enter 19900504 / 1990-05-04 / 1990/05/04. Nickname optional. Shows 6-axis % and A/B ring.",
    you:"You", nick1:"Nickname (optional)", birth1:"Date of Birth (free input)",
    hintA:"8 digits or with separators are OK. Full-width digits are auto-normalized.",
    partner:"Compatibility (Optional)",
    nick2:"Partner Nickname (optional)", birth2:"Partner Date of Birth (free input)",
    hintB:"If both exist: Compatibility % + A/B ring.",
    hint1:"OS type (Wind Ã— Circle Ã— Rubber) + 6-axis %",
    btnSelf:"Analyze", btnBoth:"Analyze Both",
    selfTitle:"Your Result", pairTitle:"Compatibility",
    sixTitle:"6 Axes (Circle-Integration) %",
    footer:"This is for fun & reflection. Enjoy the Bâ†’A flow.",
    err:"Please check the date format.",
    sixNames:[
      "Circle-Being",
      "Arrow-World",
      "Return-Growth",
      "Top-View Identity",
      "Wind Outflow â†’ Return",
      "Rubber Return Key"
    ],
    compHow:"How to play",
    ritual:"Ritual cues: (1) signal word (2) deep breath (3) â€œFinally.â€"
  };
  let isJP = (navigator.language || "ja").startsWith("ja");
  const $ = (id)=>document.getElementById(id);
  const T = ()=> isJP ? jp : en;
  function applyLang(){
    $("t_title").textContent=T().title; $("t_lead").textContent=T().lead;
    $("t_you").textContent=T().you; $("t_nick1").textContent=T().nick1;
    $("t_birth1").textContent=T().birth1; $("t_hintA").textContent=T().hintA;
    $("t_partner").textContent=T().partner; $("t_nick2").textContent=T().nick2;
    $("t_birth2").textContent=T().birth2; $("t_hintB").textContent=T().hintB;
    $("t_hint1").textContent=T().hint1; $("btnSelf").textContent=T().btnSelf;
    $("btnBoth").textContent=T().btnBoth; $("t_self_title").textContent=T().selfTitle;
    $("t_pair_title").textContent=T().pairTitle; $("t_six_title").textContent=T().sixTitle;
    $("t_footer").textContent=T().footer; $("errA").textContent=T().err; $("errB").textContent=T().err;
  }
  $("langBtn").addEventListener("click", ()=>{ isJP=!isJP; applyLang(); });
  applyLang();

  // ===== Flexible Date Parser =====
  function parseFlexibleDate(str){
    if(!str) return null;
    const z2h = String(str).trim().replace(/[ï¼-ï¼™ï¼ï¼ï¼ãƒ¼âˆ’]/g, ch=>{
      const map={"ï¼":"0","ï¼‘":"1","ï¼’":"2","ï¼“":"3","ï¼”":"4","ï¼•":"5","ï¼–":"6","ï¼—":"7","ï¼˜":"8","ï¼™":"9","ï¼":"/","ï¼":"-","ãƒ¼":"-","âˆ’":"-"};
      return map[ch] ?? ch;
    });
    const digits = z2h.replace(/[^\d]/g,"");
    if(digits.length !== 8) return null;
    const y=+digits.slice(0,4), m=+digits.slice(4,6), d=+digits.slice(6,8);
    if(m<1||m>12||d<1||d>31) return null;
    const md=[31,(y%4===0 && (y%100!==0||y%400===0))?29:28,31,30,31,30,31,31,30,31,30,31];
    if(d>md[m-1]) return null;
    return {y,m,d};
  }
  function setError(id, show){ const el=$(id); el.style.display=show?"block":"none"; }

  // ===== å…ƒç´ ã‚¿ã‚¤ãƒ—ãƒ»èª¬æ˜ =====
  const ELEMENTS=["WIND","FIRE","WATER","EARTH"];
  const EMOJI={WIND:"ğŸ’¨", FIRE:"ğŸ”¥", WATER:"ğŸŒŠ", EARTH:"ğŸª¨"};
  const JP_NAME={WIND:"é¢¨", FIRE:"ç«", WATER:"æ°´", EARTH:"åœ°"};
  const COLOR={WIND:"var(--wind)", FIRE:"var(--fire)", WATER:"var(--water)", EARTH:"var(--earth)"};
  const TAG_JP={
    WIND:"é¢¨ãŒé€šã‚‹ã¨ä¸–ç•ŒãŒè»½ã„ã€‚åˆå›³ã¯â€œæ·±ã„å‘¼å¸â€ã€‚",
    FIRE:"ç«ã¯æ„å¿—ã€‚ç‚¹ç«ã™ã‚Œã°å‘¨å›²ã‚‚æ¸©ã‹ãæ˜ã‚‹ã„ã€‚",
    WATER:"æ°´ã¯ä½™ç™½ã€‚å—ã‘ã¦æº¶ã‹ã—ã€é™ã‹ã«æº€ãŸã™ã€‚",
    EARTH:"åœ°ã¯å®‰å®šã€‚åœŸå°ãŒæ•´ãˆã°ã™ã¹ã¦ãŒè‚²ã¤ã€‚"
  };
  const TAG_EN={
    WIND:"When wind flows, the world feels light. Your cue is deeper breathing.",
    FIRE:"Fire is will. Once ignited, others warm and see further.",
    WATER:"Water is space. You dissolve pressure and fill quietly.",
    EARTH:"Earth is stability. With foundation set, everything grows."
  };

  // ===== ç›¸æ€§ãƒ©ãƒ³ã‚¯ =====
  const COMP={
    WIND:{WIND:"GOOD",FIRE:"GREAT",WATER:"GOOD",EARTH:"NEUTRAL"},
    FIRE:{WIND:"GREAT",FIRE:"SPICY",WATER:"GOOD",EARTH:"GOOD"},
    WATER:{WIND:"GOOD",FIRE:"GOOD",WATER:"GOOD",EARTH:"GREAT"},
    EARTH:{WIND:"NEUTRAL",FIRE:"GOOD",WATER:"GREAT",EARTH:"GOOD"}
  };
  const COMP_EMO={GREAT:"ğŸ’",GOOD:"ğŸ’«",NEUTRAL:"ğŸŒ—",SPICY:"ğŸŒ¶ï¸"};
  const COMP_TXT_JP={GREAT:"æœ€é«˜ã®è¿½ã„é¢¨ã€‚æ”¾ã£ã¦ãŠã„ã¦ã‚‚å›ã‚‹ç›¸æ€§ã€‚",GOOD:"å¿ƒåœ°ã‚ˆãä¼¸ã³ã‚‹ã€‚å°ã•ãªåˆå›³ã§ååˆ†ã€‚",NEUTRAL:"å¯ã‚‚ä¸å¯ã‚‚ãªã—ã€‚åˆå›³ã®â€œå„€å¼â€ã‚’æ±ºã‚ã‚‹ã¨å®‰å®šã€‚",SPICY:"åˆºæ¿€çš„ã€‚ãƒšãƒ¼ã‚¹é…æ…®ã¨åˆå›³ã®ç´„æŸãŒéµã€‚"};
  const COMP_TXT_EN={GREAT:"Top-tier tailwind. It turns by itself.",GOOD:"Comfortable growth. Small signals are enough.",NEUTRAL:"So-so. Set a small ritual cue.",SPICY:"Spicy & fun. Pace care + signal pact."};
  const COMP_SCORE={GREAT:88,GOOD:72,NEUTRAL:55,SPICY:66}; // æ¥½ã—ã„ã®ã§SPICYã¯ä¸­é«˜ã‚

  // ===== è¦ç´ åˆ¤å®šï¼šéŠã³ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆåŒä¸€å…¥åŠ›ã§å¸¸ã«åŒã˜ï¼‰ =====
  function elementFromYMD(ymd){ return ELEMENTS[(ymd.m + ymd.d) % 4]; }

  // ===== 6å¼ï¼…ã®æ“¬ä¼¼ã‚¹ã‚³ã‚¢ï¼ˆDOBã‹ã‚‰æ±ºå®šçš„ã«ç”Ÿæˆâ†’æ­£è¦åŒ–ã—ã¦100%ï¼‰ =====
  // Circle-Being / Arrow-World / Return-Growth / Top-View / WindFlow / RubberKey
  function sixVector(ymd){
    // è»½ã„LCGã§6å€¤ç”Ÿæˆ
    let seed = ymd.y*10000 + ymd.m*100 + ymd.d;
    function rnd(){ seed = (seed*1664525 + 1013904223) >>> 0; return seed/4294967295; }
    const raw = [rnd(),rnd(),rnd(),rnd(),rnd(),rnd()].map(x=>0.6 + x*0.9); // 0.6ã€œ1.5ã®å¹…
    // é¢¨Ã—å††Ã—ã‚´ãƒ ã®å‚¾æ–œï¼šæœˆæ—¥ã§å°‘ã—é‡ã¿
    raw[0] *= 1 + ((ymd.d%5)-2)*0.03; // Circle
    raw[4] *= 1 + ((ymd.m%4)-1)*0.04; // Wind
    raw[5] *= 1 + (((ymd.y%10)-5)*0.01); // Rubber ritual
    // æ­£è¦åŒ–â†’ç™¾åˆ†ç‡
    const sum = raw.reduce((a,b)=>a+b,0);
    return raw.map(v=>Math.round((v/sum)*100));
  }

  function fancyName(el){ return isJP ? `${JP_NAME[el]}ï¼ˆ${el}ï¼‰` : el; }
  function buildSelfText(name, el){
    const line = isJP ? TAG_JP[el] : TAG_EN[el];
    const who = name ? (isJP?`${name} ã¯`:`${name} is`) : (isJP?`ã‚ãªãŸã¯`:`You are`);
    const headline = {
      WIND:isJP?"ã—ãªã‚„ã‹ãªé¢¨ï¼å—ã‘è¿”ã™é”äºº":"Supple Wind / Master of Return",
      FIRE:isJP?"ç¯ã™ç«ï¼ç‚¹ç«ã®å°ç·š":"Kindling Fire / Sparkline",
      WATER:isJP?"ã‚„ã‚ã‚‰ã‹ãªæ°´ï¼ä½™ç™½ã®é­”æ³•":"Gentle Water / Space Maker",
      EARTH:isJP?"ã‚†ã‚‹ããªã„åœ°ï¼åœŸå°ãƒ“ãƒ«ãƒ€ãƒ¼":"Steady Earth / Ground Builder",
    }[el];
    const tip = isJP
      ? "åˆå›³ï¼šå‘¼å¸ãƒ»å§¿å‹¢ãƒ»ä¸€åº¦ç«‹ã¡æ­¢ã¾ã‚‹ã€‚å¤–åœ§ã¯â€œå¸åâ†’èª¿æ•´â†’è¿”ã™â€ã€‚"
      : "Cue: breath, posture, tiny pause. Handle pressure with â€œabsorb â†’ modulate â†’ reflect.â€";
    return `ğŸª„ <b>${who} ${fancyName(el)}</b>ã€‚<br>${line}<br><br><b>ã€${headline}ã€‘</b><br>${tip}`;
  }
  function buildSelfBadges(el){
    const box=$("selfBadges"); box.innerHTML="";
    const add=(html)=>{ const s=document.createElement("span"); s.className="badge"; s.innerHTML=html; box.appendChild(s); };
    add(`<span class="emo">${EMOJI[el]}</span> <b style="color:${COLOR[el]}">${fancyName(el)}</b>`);
    add(`<span class="emo">ğŸ’ </span> Core=Rubber`);
    add(`<span class="emo">ğŸ’¨</span> Wind=Flow`);
    add(`<span class="emo">â­•</span> Circle=Return`);
  }

  // 6å¼ãƒãƒ¼ç”Ÿæˆ
  function renderSix(rows, pct){
    rows.innerHTML="";
    const names = T().sixNames;
    const colors = ["#8b5cf6","#22d3ee","#f97316","#10b981","#60a5fa","#f472b6"]; // è¦‹ã‚„ã™ã„6è‰²
    names.forEach((nm,i)=>{
      const row=document.createElement("div"); row.className="six-row";
      const nmEl=document.createElement("div"); nmEl.className="six-name"; nmEl.textContent=nm;
      const bar=document.createElement("div"); bar.className="bar";
      const fill=document.createElement("i"); fill.style.background=colors[i]; bar.appendChild(fill);
      const pc=document.createElement("div"); pc.className="pct"; pc.textContent=pct[i]+"%";
      row.append(nmEl,bar,pc); rows.appendChild(row);
      // ã‚¢ãƒ‹ãƒ¡å¹…
      requestAnimationFrame(()=>{ fill.style.width=pct[i]+"%"; });
    });
  }

  // å††ç’°SVGã‚¢ãƒ¼ã‚¯
  function arcPath(cx,cy,r,startDeg,spanDeg){
    const toXY=(deg)=>[cx + r*Math.cos((deg-90)*Math.PI/180), cy + r*Math.sin((deg-90)*Math.PI/180)];
    const endDeg = startDeg + spanDeg;
    const largeArc = spanDeg > 180 ? 1 : 0;
    const [sx,sy]=toXY(startDeg), [ex,ey]=toXY(endDeg);
    return `M ${sx} ${sy} A ${r} ${r} 0 ${largeArc} 1 ${ex} ${ey}`;
  }

  // ãƒ©ãƒ³ã‚¯â†’ã‚¹ã‚³ã‚¢ï¼…ã¨ã‚¢ãƒ¼ã‚¯è§’åº¦
  function compVisual(rank){
    const score = COMP_SCORE[rank];
    // ã‚¢ãƒ¼ã‚¯è§’ã¯ 180ã€œ330åº¦ã®é–“ã§å¤‰åŒ–ï¼ˆè¦‹æ „ãˆï¼‰
    const span = {GREAT:300, GOOD:240, SPICY:220, NEUTRAL:180}[rank] || 220;
    return {score, span};
  }

  function buildPair(elA, elB, nameA, nameB){
    const rank = COMP[elA][elB];
    const emo = COMP_EMO[rank];
    const line = isJP ? COMP_TXT_JP[rank] : COMP_TXT_EN[rank];
    const whoA = nameA || (isJP?"ã‚ãªãŸ":"You");
    const whoB = nameB || (isJP?"ç›¸æ‰‹":"Partner");
    const lead = isJP ? "å…ƒç´ " : "Elements";
    const cue = isJP ? jp.ritual : en.ritual;

    $("pairBadges").innerHTML =
      `<span class="badge"><span class="emo">${EMOJI[elA]}</span>${whoA}: <b style="color:${COLOR[elA]}">${fancyName(elA)}</b></span>
       <span class="badge"><span class="emo">${EMOJI[elB]}</span>${whoB}: <b style="color:${COLOR[elB]}">${fancyName(elB)}</b></span>
       <span class="badge"><span class="emo">${emo}</span>${lead}: <b>${rank}</b></span>`;
    $("pairText").innerHTML = `${emo} <b>${rank}</b> â€” ${line}<br><br><b>${isJP?jp.compHow:en.compHow}</b>ï¼š${cue}`;

    // å††ç’°ã‚¢ãƒ¼ã‚¯æç”»
    const {score, span} = compVisual(rank);
    const start = 20; // èµ·ç‚¹
    $("arcA").setAttribute("d", arcPath(120,120,90,start, span));
    $("arcA").setAttribute("stroke", "url(#gradA)");
    $("arcB").setAttribute("d", arcPath(120,120,65,start+10, Math.max(160, span-40)));
    $("arcB").setAttribute("stroke", "url(#gradB)");
    $("ringScore").textContent = score + "%";

    // ãƒ©ãƒ™ãƒ«
    $("ringLabels").innerHTML = `
      <span class="rtag">${whoA}: <b style="color:${COLOR[elA]}">${fancyName(elA)}</b></span>
      <span class="rtag">${whoB}: <b style="color:${COLOR[elB]}">${fancyName(elB)}</b></span>
    `;
  }

  // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
  function hookValidate(inputId, errId){
    const el=$(inputId);
    el.addEventListener("blur", ()=>{
      const ok = !!parseFlexibleDate(el.value);
      setError(errId, !ok && el.value.trim()!=="");
    });
  }
  hookValidate("dateA","errA"); hookValidate("dateB","errB");

  // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ï¼†â€œé£›ã³â€ã‚¢ãƒ‹ãƒ¡
  function revealBox(id){
    const box=$(id); box.hidden=false;
    // ãƒªãƒ•ãƒ­ãƒ¼å¾Œã«inä»˜ä¸
    requestAnimationFrame(()=> box.classList.add("in"));
    box.scrollIntoView({behavior:"smooth", block:"start"});
  }
  function resetBox(id){
    const box=$(id); box.hidden=true; box.classList.remove("in");
  }

  // ã‚¤ãƒ™ãƒ³ãƒˆ
  $("btnSelf").addEventListener("click", ()=>{
    const ymd=parseFlexibleDate($("dateA").value);
    if(!ymd){ setError("errA", true); return; }
    setError("errA", false);
    const el=elementFromYMD(ymd);
    buildSelfBadges(el);
    $("selfText").innerHTML = buildSelfText($("nickA").value.trim(), el);
    // 6å¼ï¼…
    const vec = sixVe